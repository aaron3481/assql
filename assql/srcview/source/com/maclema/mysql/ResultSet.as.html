<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ResultSet.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="asPackage">package</span> com.maclema.mysql
<span class="asBracket">{</span>
    <span class="asReserved">import</span> mx.collections.ArrayCollection;
    <span class="asReserved">import</span> flash.utils.ByteArray;
    <span class="asReserved">import</span> flash.display.BitmapData;
    <span class="asReserved">import</span> flash.display.Bitmap;
    <span class="asReserved">import</span> flash.display.Loader;
    
    <span class="asReserved">public</span> <span class="asClass">class</span> ResultSet
    <span class="asBracket">{</span>
        <span class="asDoc">/**
         * Used by Connection when building the ResultSet, should never
         * be called directly
         **/</span>
        <span class="asReserved">public</span> <span class="asReserved">static</span> <span class="asFunction">function</span> addColumn<span class="asBracket">(</span>rs<span class="asOperator">:</span>ResultSet, column<span class="asOperator">:</span>Field<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span>
        <span class="asBracket">{</span>
            rs.columns.push<span class="asBracket">(</span>column<span class="asBracket">)</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Used by Connection when building the ResultSet, should never
         * be called directly
         **/</span>
        <span class="asReserved">public</span> <span class="asReserved">static</span> <span class="asFunction">function</span> addRow<span class="asBracket">(</span>rs<span class="asOperator">:</span>ResultSet, row<span class="asOperator">:</span>Array<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span>
        <span class="asBracket">{</span>
            rs.rows.push<span class="asBracket">(</span>row<span class="asBracket">)</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Used by Connection when building the ResultSet, should never
         * be called directly
         **/</span>
        <span class="asReserved">public</span> <span class="asReserved">static</span> <span class="asFunction">function</span> initialize<span class="asBracket">(</span>rs<span class="asOperator">:</span>ResultSet<span class="asBracket">)</span><span class="asOperator">:</span><span class="asReserved">void</span>
        <span class="asBracket">{</span>
            rs.nameMap <span class="asOperator">=</span> <span class="asReserved">new</span> Object<span class="asBracket">()</span>;
            <span class="asReserved">for</span> <span class="asBracket">(</span> <span class="asVar">var</span> i<span class="asOperator">:</span>int<span class="asOperator">=</span>0; i<span class="asOperator">&lt;</span>rs.columns.length; i<span class="asOperator">++</span> <span class="asBracket">)</span>
            <span class="asBracket">{</span>
                <span class="asVar">var</span> c<span class="asOperator">:</span>Field <span class="asOperator">=</span> Field<span class="asBracket">(</span>rs.columns<span class="asBracket">[</span>i<span class="asBracket">])</span>;
                rs.nameMap<span class="asBracket">[</span>c.getName<span class="asBracket">()]</span> <span class="asOperator">=</span> <span class="asBracket">(</span>i<span class="asOperator">+</span>1<span class="asBracket">)</span>;
            <span class="asBracket">}</span>
        <span class="asBracket">}</span>
        
        <span class="asReserved">private</span> <span class="asVar">var</span> index<span class="asOperator">:</span>int <span class="asOperator">=</span> <span class="asOperator">-</span>1;
        <span class="asReserved">private</span> <span class="asVar">var</span> columns<span class="asOperator">:</span>Array;
        <span class="asReserved">private</span> <span class="asVar">var</span> rows<span class="asOperator">:</span>Array;
        <span class="asReserved">private</span> <span class="asVar">var</span> nameMap<span class="asOperator">:</span>Object;
        
        <span class="asReserved">public</span> <span class="asFunction">function</span> ResultSet<span class="asBracket">()</span>
        <span class="asBracket">{</span>
            <span class="asReserved">this</span>.columns <span class="asOperator">=</span> <span class="asReserved">new</span> Array<span class="asBracket">()</span>;
            <span class="asReserved">this</span>.rows <span class="asOperator">=</span> <span class="asReserved">new</span> Array<span class="asBracket">()</span>;    
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns the number of columns in the ResultSet
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> <span class="asReserved">get</span> numColumns<span class="asBracket">()</span><span class="asOperator">:</span>int
        <span class="asBracket">{</span>
            <span class="asReserved">return</span> columns.length;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Advances the pointer to the next row
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> next<span class="asBracket">()</span><span class="asOperator">:</span>Boolean
        <span class="asBracket">{</span>
            <span class="asReserved">if</span> <span class="asBracket">(</span> index <span class="asOperator">&lt;</span> rows.length<span class="asOperator">-</span>1 <span class="asBracket">)</span>
            <span class="asBracket">{</span>
                index<span class="asOperator">++</span>;
                <span class="asReserved">return</span> <span class="asReserved">true</span>;
            <span class="asBracket">}</span>
            
            <span class="asReserved">return</span> <span class="asReserved">false</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Moves the pointer to the first row
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> first<span class="asBracket">()</span><span class="asOperator">:</span>Boolean
        <span class="asBracket">{</span>
            <span class="asReserved">if</span> <span class="asBracket">(</span> rows.length <span class="asOperator">==</span> 0 <span class="asBracket">)</span>
            <span class="asBracket">{</span>
                index <span class="asOperator">=</span> <span class="asOperator">-</span>1;
                <span class="asReserved">return</span> <span class="asReserved">false</span>;
            <span class="asBracket">}</span>
            
            index <span class="asOperator">=</span> 0;
            <span class="asReserved">return</span> <span class="asReserved">true</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Moves the pointer to the last row.
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> last<span class="asBracket">()</span><span class="asOperator">:</span>Boolean
        <span class="asBracket">{</span>
            <span class="asReserved">if</span> <span class="asBracket">(</span> rows.length <span class="asOperator">==</span> 0 <span class="asBracket">)</span>
            <span class="asBracket">{</span>
                index <span class="asOperator">=</span> <span class="asOperator">-</span>1;
                <span class="asReserved">return</span> <span class="asReserved">false</span>;
            <span class="asBracket">}</span>
            
            index <span class="asOperator">=</span> rows.length;
            <span class="asReserved">return</span> <span class="asReserved">true</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns a String value from the specified column. You may specify
         * columns using a 1-based number or the column name
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getString<span class="asBracket">(</span>column<span class="asOperator">:*</span><span class="asBracket">)</span><span class="asOperator">:</span>String
        <span class="asBracket">{</span>
            <span class="asVar">var</span> data<span class="asOperator">:</span>ByteArray <span class="asOperator">=</span> getBinary<span class="asBracket">(</span>column<span class="asBracket">)</span>;
            data.position <span class="asOperator">=</span> 0;
            <span class="asReserved">return</span> data.readUTFBytes<span class="asBracket">(</span>data.bytesAvailable<span class="asBracket">)</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns an int for the specifiec column
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getInt<span class="asBracket">(</span>column<span class="asOperator">:*</span><span class="asBracket">)</span><span class="asOperator">:</span>int
        <span class="asBracket">{</span>
            <span class="asReserved">return</span> int<span class="asBracket">(</span>getString<span class="asBracket">(</span>column<span class="asBracket">))</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns a Number for the specifiec column
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getNumber<span class="asBracket">(</span>column<span class="asOperator">:*</span><span class="asBracket">)</span><span class="asOperator">:</span>Number
        <span class="asBracket">{</span>
            <span class="asReserved">return</span> Number<span class="asBracket">(</span>getString<span class="asBracket">(</span>column<span class="asBracket">))</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns a Date object for the specified column
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getDate<span class="asBracket">(</span>column<span class="asOperator">:*</span><span class="asBracket">)</span><span class="asOperator">:</span>Date
        <span class="asBracket">{</span>
            <span class="asVar">var</span> dateString<span class="asOperator">:</span>String <span class="asOperator">=</span> getString<span class="asBracket">(</span>column<span class="asBracket">)</span>;
            
            <span class="asVar">var</span> pat<span class="asOperator">:</span>RegExp <span class="asOperator">=</span> <span class="asString">/-/</span>g;
            dateString <span class="asOperator">=</span> dateString.replace<span class="asBracket">(</span>pat, <span class="asString">&quot;/&quot;</span><span class="asBracket">)</span>;

            <span class="asReserved">return</span> <span class="asReserved">new</span> Date<span class="asBracket">(</span> Date.parse<span class="asBracket">(</span>dateString<span class="asBracket">)</span> <span class="asBracket">)</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns a binary ByteArray for the specified column
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getBinary<span class="asBracket">(</span>column<span class="asOperator">:*</span><span class="asBracket">)</span><span class="asOperator">:</span>ByteArray
        <span class="asBracket">{</span>
            <span class="asVar">var</span> colIndex<span class="asOperator">:</span>int;
            
            <span class="asReserved">if</span> <span class="asBracket">(</span> column <span class="asReserved">in</span> Number <span class="asOperator">||</span> column <span class="asReserved">in</span> int <span class="asOperator">||</span> column <span class="asReserved">is</span> uint <span class="asBracket">)</span>
            <span class="asBracket">{</span>
                colIndex <span class="asOperator">=</span> int<span class="asBracket">(</span>column<span class="asBracket">)</span>;
            <span class="asBracket">}</span>
            <span class="asReserved">else</span> <span class="asReserved">if</span> <span class="asBracket">(</span> column <span class="asReserved">is</span> String <span class="asBracket">)</span>
            <span class="asBracket">{</span>
                colIndex <span class="asOperator">=</span> int<span class="asBracket">(</span>nameMap<span class="asBracket">[</span>String<span class="asBracket">(</span>column<span class="asBracket">)])</span>;
            <span class="asBracket">}</span>
            <span class="asReserved">else</span>
            <span class="asBracket">{</span>
                <span class="asReserved">throw</span> <span class="asReserved">new</span> Error<span class="asBracket">(</span><span class="asString">&quot;Can only select columns using their name or index&quot;</span><span class="asBracket">)</span>;
            <span class="asBracket">}</span>
            
            colIndex <span class="asOperator">-=</span> 1; <span class="asComment">//columns are 1-based
</span>            
            <span class="asReserved">return</span> ByteArray<span class="asBracket">(</span>rows<span class="asBracket">[</span>index<span class="asBracket">][</span>colIndex<span class="asBracket">])</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns all rows as a bindable ArrayCollection
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getRows<span class="asBracket">()</span><span class="asOperator">:</span>ArrayCollection
        <span class="asBracket">{</span>
            <span class="asReserved">return</span> <span class="asReserved">new</span> ArrayCollection<span class="asBracket">(</span>rows<span class="asBracket">)</span>;
        <span class="asBracket">}</span>
        
        <span class="asDoc">/**
         * Returns an array for Field objects
         **/</span>
        <span class="asReserved">public</span> <span class="asFunction">function</span> getColumns<span class="asBracket">()</span><span class="asOperator">:</span>Array
        <span class="asBracket">{</span>
            <span class="asReserved">return</span> columns;
        <span class="asBracket">}</span>
    <span class="asBracket">}</span>
<span class="asBracket">}</span></pre></body>
</html>
